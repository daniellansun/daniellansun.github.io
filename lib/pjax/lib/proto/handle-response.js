var clone=require("../util/clone");var newUid=require("../uniqueid");var trigger=require("../events/trigger");module.exports=function(e,t,r,o){o=clone(o||this.options);o.request=t;if(e===false){trigger(document,"pjax:complete pjax:error",o);return}var s=window.history.state||{};window.history.replaceState({url:s.url||window.location.href,title:s.title||document.title,uid:s.uid||newUid(),scrollPos:[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop]},document.title,window.location.href);var i=r;if(t.responseURL){if(r!==t.responseURL){r=t.responseURL}}else if(t.getResponseHeader("X-PJAX-URL")){r=t.getResponseHeader("X-PJAX-URL")}else if(t.getResponseHeader("X-XHR-Redirected-To")){r=t.getResponseHeader("X-XHR-Redirected-To")}var n=document.createElement("a");n.href=i;var l=n.hash;n.href=r;if(l&&!n.hash){n.hash=l;r=n.href}this.state.href=r;this.state.options=o;try{this.loadContent(e,o)}catch(e){trigger(document,"pjax:error",o);if(!this.options.debug){if(console&&console.error){console.error("Pjax switch fail: ",e)}return this.latestChance(r)}else{throw e}}};