(function(t){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=t()}else if(typeof define==="function"&&define.amd){define([],t)}else{var e;if(typeof window!=="undefined"){e=window}else if(typeof global!=="undefined"){e=global}else if(typeof self!=="undefined"){e=self}else{e=this}e.Pjax=t()}})((function(){var t,e,o;return function(){function t(e,o,n){function i(s,a){if(!o[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=o[s]={exports:{}};e[s][0].call(u.exports,(function(t){var o=e[s][1][t];return i(o||t)}),u,u.exports,t,e,o,n)}return o[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}return t}()({1:[function(t,e,o){var n=t("./lib/foreach-els");var i=t("./lib/parse-options");var r=t("./lib/switches");var s=t("./lib/uniqueid");var a=t("./lib/events/on");var l=t("./lib/events/trigger");var c=t("./lib/util/clone");var u=t("./lib/util/contains");var f=t("./lib/util/extend");var h=t("./lib/util/noop");var d=function(t){this.state={numPendingSwitches:0,href:null,options:null};this.options=i(t);this.log("Pjax options",this.options);if(this.options.scrollRestoration&&"scrollRestoration"in history){history.scrollRestoration="manual"}this.maxUid=this.lastUid=s();this.parseDOM(document);a(window,"popstate",function(t){if(t.state){var e=c(this.options);e.url=t.state.url;e.title=t.state.title;e.history=false;e.scrollPos=t.state.scrollPos;if(t.state.uid<this.lastUid){e.backward=true}else{e.forward=true}this.lastUid=t.state.uid;this.loadUrl(t.state.url,e)}}.bind(this))};d.switches=r;d.prototype={log:t("./lib/proto/log"),getElements:function(t){return t.querySelectorAll(this.options.elements)},parseDOM:function(e){var o=t("./lib/proto/parse-element");n(this.getElements(e),o,this)},refresh:function(t){this.parseDOM(t||document)},reload:function(){window.location.reload()},attachLink:t("./lib/proto/attach-link"),attachForm:t("./lib/proto/attach-form"),forEachSelectors:function(e,o,n){return t("./lib/foreach-selectors").bind(this)(this.options.selectors,e,o,n)},switchSelectors:function(e,o,n,i){return t("./lib/switches-selectors").bind(this)(this.options.switches,this.options.switchesOptions,e,o,n,i)},latestChance:function(t){window.location=t},onSwitch:function(){l(window,"resize scroll");this.state.numPendingSwitches--;if(this.state.numPendingSwitches===0){this.afterAllSwitches()}},loadContent:function(t,e){if(typeof t!=="string"){l(document,"pjax:complete pjax:error",e);return}var o=document.implementation.createHTMLDocument("pjax");var n=/<html[^>]+>/gi;var i=/\s?[a-z:]+(?:=['"][^'">]+['"])*/gi;var r=t.match(n);if(r&&r.length){r=r[0].match(i);if(r.length){r.shift();r.forEach((function(t){var e=t.trim().split("=");if(e.length===1){o.documentElement.setAttribute(e[0],true)}else{o.documentElement.setAttribute(e[0],e[1].slice(1,-1))}}))}}o.documentElement.innerHTML=t;this.log("load content",o.documentElement.attributes,o.documentElement.innerHTML.length);if(document.activeElement&&u(document,this.options.selectors,document.activeElement)){try{document.activeElement.blur()}catch(t){}}this.switchSelectors(this.options.selectors,o,document,e)},abortRequest:t("./lib/abort-request"),doRequest:t("./lib/send-request"),handleResponse:t("./lib/proto/handle-response"),loadUrl:function(t,e){e=typeof e==="object"?f({},this.options,e):c(this.options);this.log("load href",t,e);this.abortRequest(this.request);l(document,"pjax:send",e);this.request=this.doRequest(t,e,this.handleResponse.bind(this))},afterAllSwitches:function(){var t=Array.prototype.slice.call(document.querySelectorAll("[autofocus]")).pop();if(t&&document.activeElement!==t){t.focus()}this.options.selectors.forEach((function(t){n(document.querySelectorAll(t),(function(t){if(t===0);}))}));var e=this.state;if(e.options.history){if(!window.history.state){this.lastUid=this.maxUid=s();window.history.replaceState({url:window.location.href,title:document.title,uid:this.maxUid,scrollPos:[0,0]},document.title)}this.lastUid=this.maxUid=s();window.history.pushState({url:e.href,title:e.options.title,uid:this.maxUid,scrollPos:[0,0]},e.options.title,e.href)}this.forEachSelectors((function(t){this.parseDOM(t)}),this);l(document,"pjax:complete pjax:success",e.options);if(typeof e.options.analytics==="function"){e.options.analytics()}if(e.options.history){var o=document.createElement("a");o.href=this.state.href;if(o.hash){var i=o.hash.slice(1);i=decodeURIComponent(i);var r=0;var a=document.getElementById(i)||document.getElementsByName(i)[0];if(a){if(a.offsetParent){do{r+=a.offsetTop;a=a.offsetParent}while(a)}}window.scrollTo(0,r)}else if(e.options.scrollTo!==false){if(e.options.scrollTo.length>1){window.scrollTo(e.options.scrollTo[0],e.options.scrollTo[1])}else{window.scrollTo(0,e.options.scrollTo)}}}else if(e.options.scrollRestoration&&e.options.scrollPos){window.scrollTo(e.options.scrollPos[0],e.options.scrollPos[1])}this.state={numPendingSwitches:0,href:null,options:null}}};d.isSupported=t("./lib/is-supported");if(d.isSupported()){e.exports=d}else{var p=h;for(var m in d.prototype){if(d.prototype.hasOwnProperty(m)&&typeof d.prototype[m]==="function"){p[m]=h}}e.exports=p}},{"./lib/abort-request":2,"./lib/events/on":3,"./lib/events/trigger":4,"./lib/foreach-els":5,"./lib/foreach-selectors":6,"./lib/is-supported":7,"./lib/parse-options":8,"./lib/proto/attach-form":9,"./lib/proto/attach-link":10,"./lib/proto/handle-response":11,"./lib/proto/log":12,"./lib/proto/parse-element":13,"./lib/send-request":14,"./lib/switches":16,"./lib/switches-selectors":15,"./lib/uniqueid":17,"./lib/util/clone":18,"./lib/util/contains":19,"./lib/util/extend":20,"./lib/util/noop":21}],2:[function(t,e,o){var n=t("./util/noop");e.exports=function(t){if(t&&t.readyState<4){t.onreadystatechange=n;t.abort()}}},{"./util/noop":21}],3:[function(t,e,o){var n=t("../foreach-els");e.exports=function(t,e,o,i){e=typeof e==="string"?e.split(" "):e;e.forEach((function(e){n(t,(function(t){t.addEventListener(e,o,i)}))}))}},{"../foreach-els":5}],4:[function(t,e,o){var n=t("../foreach-els");e.exports=function(t,e,o){e=typeof e==="string"?e.split(" "):e;e.forEach((function(e){var i;i=document.createEvent("HTMLEvents");i.initEvent(e,true,true);i.eventName=e;if(o){Object.keys(o).forEach((function(t){i[t]=o[t]}))}n(t,(function(t){var e=false;if(!t.parentNode&&t!==document&&t!==window){e=true;document.body.appendChild(t)}t.dispatchEvent(i);if(e){t.parentNode.removeChild(t)}}))}))}},{"../foreach-els":5}],5:[function(t,e,o){e.exports=function(t,e,o){if(t instanceof HTMLCollection||t instanceof NodeList||t instanceof Array){return Array.prototype.forEach.call(t,e,o)}return e.call(o,t)}},{}],6:[function(t,e,o){var n=t("./foreach-els");e.exports=function(t,e,o,i){i=i||document;t.forEach((function(t){n(i.querySelectorAll(t),e,o)}))}},{"./foreach-els":5}],7:[function(t,e,o){e.exports=function(){return window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/)}},{}],8:[function(t,e,o){var n=t("./switches");e.exports=function(t){t=t||{};t.elements=t.elements||"a[href], form[action]";t.selectors=t.selectors||["title",".js-Pjax"];t.switches=t.switches||{};t.switchesOptions=t.switchesOptions||{};t.history=typeof t.history==="undefined"?true:t.history;t.analytics=typeof t.analytics==="function"||t.analytics===false?t.analytics:i;t.scrollTo=typeof t.scrollTo==="undefined"?0:t.scrollTo;t.scrollRestoration=typeof t.scrollRestoration!=="undefined"?t.scrollRestoration:true;t.cacheBust=typeof t.cacheBust==="undefined"?true:t.cacheBust;t.debug=t.debug||false;t.timeout=t.timeout||0;t.currentUrlFullReload=typeof t.currentUrlFullReload==="undefined"?false:t.currentUrlFullReload;if(!t.switches.head){t.switches.head=n.switchElementsAlt}if(!t.switches.body){t.switches.body=n.switchElementsAlt}return t};function i(){if(window._gaq){_gaq.push(["_trackPageview"])}if(window.ga){ga("send","pageview",{page:location.pathname,title:document.title})}}},{"./switches":16}],9:[function(t,e,o){var n=t("../events/on");var i=t("../util/clone");var r="data-pjax-state";var s=function(t,e){if(c(e)){return}var o=i(this.options);o.requestOptions={requestUrl:t.getAttribute("action")||window.location.href,requestMethod:t.getAttribute("method")||"GET"};var n=document.createElement("a");n.setAttribute("href",o.requestOptions.requestUrl);var s=l(n,o);if(s){t.setAttribute(r,s);return}e.preventDefault();if(t.enctype==="multipart/form-data"){o.requestOptions.formData=new FormData(t)}else{o.requestOptions.requestParams=a(t)}t.setAttribute(r,"submit");o.triggerElement=t;this.loadUrl(n.href,o)};function a(t){var e=[];var o=t.elements;for(var n=0;n<o.length;n++){var i=o[n];var r=i.tagName.toLowerCase();if(!!i.name&&i.attributes!==undefined&&r!=="button"){var s=i.attributes.type;if(!s||s.value!=="checkbox"&&s.value!=="radio"||i.checked){var a=[];if(r==="select"){var l;for(var c=0;c<i.options.length;c++){l=i.options[c];if(l.selected&&!l.disabled){a.push(l.hasAttribute("value")?l.value:l.text)}}}else{a.push(i.value)}for(var u=0;u<a.length;u++){e.push({name:encodeURIComponent(i.name),value:encodeURIComponent(a[u])})}}}}return e}function l(t,e){if(t.protocol!==window.location.protocol||t.host!==window.location.host){return"external"}if(t.hash&&t.href.replace(t.hash,"")===window.location.href.replace(location.hash,"")){return"anchor"}if(t.href===window.location.href.split("#")[0]+"#"){return"anchor-empty"}if(e.currentUrlFullReload&&t.href===window.location.href.split("#")[0]){return"reload"}}var c=function(t){return t.defaultPrevented||t.returnValue===false};e.exports=function(t){var e=this;t.setAttribute(r,"");n(t,"submit",(function(o){s.call(e,t,o)}))}},{"../events/on":3,"../util/clone":18}],10:[function(t,e,o){var n=t("../events/on");var i=t("../util/clone");var r="data-pjax-state";var s=function(t,e){if(l(e)){return}var o=i(this.options);var n=a(t,e);if(n){t.setAttribute(r,n);return}e.preventDefault();if(this.options.currentUrlFullReload&&t.href===window.location.href.split("#")[0]){t.setAttribute(r,"reload");this.reload();return}t.setAttribute(r,"load");o.triggerElement=t;this.loadUrl(t.href,o)};function a(t,e){if(e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey){return"modifier"}if(t.protocol!==window.location.protocol||t.host!==window.location.host){return"external"}if(t.hash&&t.href.replace(t.hash,"")===window.location.href.replace(location.hash,"")){return"anchor"}if(t.href===window.location.href.split("#")[0]+"#"){return"anchor-empty"}}var l=function(t){return t.defaultPrevented||t.returnValue===false};e.exports=function(t){var e=this;t.setAttribute(r,"");n(t,"click",(function(o){s.call(e,t,o)}));n(t,"keyup",function(o){if(o.keyCode===13){s.call(e,t,o)}}.bind(this))}},{"../events/on":3,"../util/clone":18}],11:[function(t,e,o){var n=t("../util/clone");var i=t("../uniqueid");var r=t("../events/trigger");e.exports=function(t,e,o,s){s=n(s||this.options);s.request=e;if(t===false){r(document,"pjax:complete pjax:error",s);return}var a=window.history.state||{};window.history.replaceState({url:a.url||window.location.href,title:a.title||document.title,uid:a.uid||i(),scrollPos:[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop]},document.title,window.location.href);var l=o;if(e.responseURL){if(o!==e.responseURL){o=e.responseURL}}else if(e.getResponseHeader("X-PJAX-URL")){o=e.getResponseHeader("X-PJAX-URL")}else if(e.getResponseHeader("X-XHR-Redirected-To")){o=e.getResponseHeader("X-XHR-Redirected-To")}var c=document.createElement("a");c.href=l;var u=c.hash;c.href=o;if(u&&!c.hash){c.hash=u;o=c.href}this.state.href=o;this.state.options=s;try{this.loadContent(t,s)}catch(t){r(document,"pjax:error",s);if(!this.options.debug){if(console&&console.error){console.error("Pjax switch fail: ",t)}return this.latestChance(o)}else{throw t}}}},{"../events/trigger":4,"../uniqueid":17,"../util/clone":18}],12:[function(t,e,o){e.exports=function(){if(this.options.debug&&console){if(typeof console.log==="function"){console.log.apply(console,arguments)}else if(console.log){console.log(arguments)}}}},{}],13:[function(t,e,o){var n="data-pjax-state";e.exports=function(t){switch(t.tagName.toLowerCase()){case"a":if(!t.hasAttribute(n)){this.attachLink(t)}break;case"form":if(!t.hasAttribute(n)){this.attachForm(t)}break;default:throw"Pjax can only be applied on <a> or <form> submit"}}},{}],14:[function(t,e,o){var n=t("./util/update-query-string");e.exports=function(t,e,o){e=e||{};var i;var r=e.requestOptions||{};var s=(r.requestMethod||"GET").toUpperCase();var a=r.requestParams||null;var l=r.formData||null;var c=null;var u=new XMLHttpRequest;var f=e.timeout||0;u.onreadystatechange=function(){if(u.readyState===4){if(u.status===200){o(u.responseText,u,t,e)}else if(u.status!==0){o(null,u,t,e)}}};u.onerror=function(n){console.log(n);o(null,u,t,e)};u.ontimeout=function(){o(null,u,t,e)};if(a&&a.length){i=a.map((function(t){return t.name+"="+t.value})).join("&");switch(s){case"GET":t=t.split("?")[0];t+="?"+i;break;case"POST":c=i;break}}else if(l){c=l}if(e.cacheBust){t=n(t,"t",Date.now())}u.open(s,t,true);u.timeout=f;u.setRequestHeader("X-Requested-With","XMLHttpRequest");u.setRequestHeader("X-PJAX","true");u.setRequestHeader("X-PJAX-Selectors",JSON.stringify(e.selectors));if(c&&s==="POST"&&!l){u.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}u.send(c);return u}},{"./util/update-query-string":22}],15:[function(t,e,o){var n=t("./foreach-els");var i=t("./switches");e.exports=function(t,e,o,r,s,a){var l=[];o.forEach((function(o){var c=r.querySelectorAll(o);var u=s.querySelectorAll(o);if(this.log){this.log("Pjax switch",o,c,u)}if(c.length!==u.length){throw"DOM doesn’t look the same on new loaded page: ’"+o+"’ - new "+c.length+", old "+u.length}n(c,(function(n,r){var s=u[r];if(this.log){this.log("newEl",n,"oldEl",s)}var c=t[o]?t[o].bind(this,s,n,a,e[o]):i.outerHTML.bind(this,s,n,a);l.push(c)}),this)}),this);this.state.numPendingSwitches=l.length;l.forEach((function(t){t()}))}},{"./foreach-els":5,"./switches":16}],16:[function(t,e,o){var n=t("./events/on");e.exports={outerHTML:function(t,e){t.outerHTML=e.outerHTML;this.onSwitch()},innerHTML:function(t,e){t.innerHTML=e.innerHTML;if(e.className===""){t.removeAttribute("class")}else{}this.onSwitch()},switchElementsAlt:function(t,e){t.innerHTML=e.innerHTML;if(e.hasAttributes()){var o=e.attributes;for(var n=0;n<o.length;n++){t.attributes.setNamedItem(o[n].cloneNode())}}this.onSwitch()},replaceNode:function(t,e){t.parentNode.replaceChild(e,t);this.onSwitch()},sideBySide:function(t,e,o,i){var r=Array.prototype.forEach;var s=[];var a=[];var l=document.createDocumentFragment();var c="animationend webkitAnimationEnd MSAnimationEnd oanimationend";var u=0;var f=function(t){if(t.target!==t.currentTarget){return}u--;if(u<=0&&s){s.forEach((function(t){if(t.parentNode){t.parentNode.removeChild(t)}}));a.forEach((function(t){t.className=t.className.replace(t.getAttribute("data-pjax-classes"),"");t.removeAttribute("data-pjax-classes")}));a=null;s=null;this.onSwitch()}}.bind(this);i=i||{};r.call(t.childNodes,(function(t){s.push(t);if(t.classList&&!t.classList.contains("js-Pjax-remove")){if(t.hasAttribute("data-pjax-classes")){t.className=t.className.replace(t.getAttribute("data-pjax-classes"),"");t.removeAttribute("data-pjax-classes")}t.classList.add("js-Pjax-remove");if(i.callbacks&&i.callbacks.removeElement){i.callbacks.removeElement(t)}if(i.classNames){t.className+=" "+i.classNames.remove+" "+(o.backward?i.classNames.backward:i.classNames.forward)}u++;n(t,c,f,true)}}));r.call(e.childNodes,(function(t){if(t.classList){var e="";if(i.classNames){e=" js-Pjax-add "+i.classNames.add+" "+(o.backward?i.classNames.forward:i.classNames.backward)}if(i.callbacks&&i.callbacks.addElement){i.callbacks.addElement(t)}t.className+=e;t.setAttribute("data-pjax-classes",e);a.push(t);l.appendChild(t);u++;n(t,c,f,true)}}));t.className=e.className;t.appendChild(l)}}},{"./events/on":3}],17:[function(t,e,o){e.exports=function(){var t=0;return function(){var e="pjax"+(new Date).getTime()+"_"+t;t++;return e}}()},{}],18:[function(t,e,o){e.exports=function(t){if(null===t||"object"!==typeof t){return t}var e=t.constructor();for(var o in t){if(t.hasOwnProperty(o)){e[o]=t[o]}}return e}},{}],19:[function(t,e,o){e.exports=function t(e,o,n){for(var i=0;i<o.length;i++){var r=e.querySelectorAll(o[i]);for(var s=0;s<r.length;s++){if(r[s].contains(n)){return true}}}return false}},{}],20:[function(t,e,o){e.exports=function(t){if(t==null){return null}var e=Object(t);for(var o=1;o<arguments.length;o++){var n=arguments[o];if(n!=null){for(var i in n){if(Object.prototype.hasOwnProperty.call(n,i)){e[i]=n[i]}}}}return e}},{}],21:[function(t,e,o){e.exports=function(){}},{}],22:[function(t,e,o){e.exports=function(t,e,o){var n=new RegExp("([?&])"+e+"=.*?(&|$)","i");var i=t.indexOf("?")!==-1?"&":"?";if(t.match(n)){return t.replace(n,"$1"+e+"="+o+"$2")}else{return t+i+e+"="+o}}},{}]},{},[1])(1)}));