<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.svg"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.svg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="google-site-verification" content="h4Zye-H-4cMnH7XYgjZnzlWV66qQsrjvi1oJSwj9HRQ"><meta name="msvalidate.01" content="3EB267585E147D46D980EEEAEF29A3BE"><meta name="yandex-verification" content="70f5b7eb46d0ac08"><meta name="baidu-site-verification" content="code-ZmfQwNfOhP"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><link rel="stylesheet" href="/lib/fancybox/jquery.fancybox.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"blog.sunlan.me",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!0,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"flat"},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!0,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!0,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:-1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="概述Java并发编程中的锁机制是保证多线程安全的关键。本文将探讨Java中的无锁、偏向锁、轻量级锁、重量级锁。同时，我们也会比较这些锁与 java.util.concurrent 包中的 Lock 类之间的差异。"><meta property="og:type" content="article"><meta property="og:title" content="浅谈Java锁机制"><meta property="og:url" content="https://blog.sunlan.me/2023/11/13/%E6%B5%85%E8%B0%88Java%E9%94%81%E6%9C%BA%E5%88%B6/index.html"><meta property="og:site_name" content="山風閣"><meta property="og:description" content="概述Java并发编程中的锁机制是保证多线程安全的关键。本文将探讨Java中的无锁、偏向锁、轻量级锁、重量级锁。同时，我们也会比较这些锁与 java.util.concurrent 包中的 Lock 类之间的差异。"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2023-11-12T20:24:07.000Z"><meta property="article:modified_time" content="2025-01-04T14:36:28.671Z"><meta property="article:author" content="孙岚"><meta property="article:tag" content="Java"><meta property="article:tag" content="synchronized"><meta property="article:tag" content="Lock"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://blog.sunlan.me/2023/11/13/%E6%B5%85%E8%B0%88Java%E9%94%81%E6%9C%BA%E5%88%B6/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>浅谈Java锁机制 | 山風閣</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-1MGWXS8NRJ"></script><script>function gtag(){dataLayer.push(arguments)}CONFIG.hostname===location.hostname&&(window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-1MGWXS8NRJ"))</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?5ac3bd84e4f4831060ddf41d2d9ab1a0",document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="山風閣" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h2 class="site-title">山風閣</h2><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">Daniel Sun's Tech Vision</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-guestbook"><a href="/guestbook/" rel="section"><i class="fa fa-comments fa-fw"></i>留言</a></li><li class="menu-item menu-item-rss"><a href="/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.sunlan.me/2023/11/13/%E6%B5%85%E8%B0%88Java%E9%94%81%E6%9C%BA%E5%88%B6/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="孙岚"><meta itemprop="description" content="格物致知，宁静致远"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="山風閣"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">浅谈Java锁机制</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2023-11-13 04:24:07" itemprop="dateCreated datePublished" datetime="2023-11-13T04:24:07+08:00">2023-11-13</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2025-01-04 22:36:28" itemprop="dateModified" datetime="2025-01-04T22:36:28+08:00">2025-01-04</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>1.8k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>7 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>Java并发编程中的锁机制是保证多线程安全的关键。本文将探讨Java中的无锁、偏向锁、轻量级锁、重量级锁。同时，我们也会比较这些锁与 <code>java.util.concurrent</code> 包中的 <code>Lock</code> 类之间的差异。<span id="more"></span></p><p>简单的来说，偏向锁，轻量级锁，重量级锁分别解决三个问题：</p><ol><li>只有一个线程进入临界区</li><li>多个线程交替进入临界区</li><li>多个线程同时进入临界区</li></ol><p>而锁的升级过程是单向的：无锁 <code>-&gt;</code> 偏向锁 <code>-&gt;</code> 轻量级锁 <code>-&gt;</code> 重量级锁</p><h2 id="Java对象头与Mark-Word"><a href="#Java对象头与Mark-Word" class="headerlink" title="Java对象头与Mark Word"></a>Java对象头与Mark Word</h2><p>Java对象在内存中的布局通常包括三部分：对象头（Object Header）、实例数据（Instance Data）和对齐填充（Padding）。而在研究锁机制之前，了解Java对象头和其中的Mark Word是很有必要的。</p><h3 id="对象头"><a href="#对象头" class="headerlink" title="对象头"></a>对象头</h3><p>对象头包含两部分信息：Mark Word和类型指针。类型指针用于确定对象的类。Mark Word则存储了对象的锁状态信息、哈希码、GC分代年龄等。</p><h3 id="Mark-Word"><a href="#Mark-Word" class="headerlink" title="Mark Word"></a>Mark Word</h3><p>Mark Word是实现轻量级锁和偏向锁的关键。它的值会随着锁标记的变化而变化，包含以下几种状态：</p><table><thead><tr><th>锁状态</th><th>内存结构（以32位的JVM为例）</th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td></td><td>25bit</td><td></td><td>4bit</td><td>1bit</td><td>2bit</td></tr><tr><td></td><td>23bit</td><td>2bit</td><td></td><td>是否偏向锁</td><td>锁标志位</td></tr><tr><td>无锁</td><td>对象的HashCode</td><td></td><td>GC分代年龄</td><td>0</td><td>01</td></tr><tr><td>偏向锁</td><td>线程ID</td><td>Epoch</td><td>GC分代年龄</td><td>1</td><td>01</td></tr><tr><td>轻量级锁</td><td>指向栈中锁记录的指针</td><td></td><td></td><td></td><td>00</td></tr><tr><td>重量级锁</td><td>指向重量级锁的指针</td><td></td><td></td><td></td><td>10</td></tr><tr><td>GC标记</td><td>空</td><td></td><td></td><td></td><td>11</td></tr></tbody></table><p>这些锁状态通过CAS操作来改变，从而实现不同级别的锁。</p><h2 id="无锁（Lock-Free）"><a href="#无锁（Lock-Free）" class="headerlink" title="无锁（Lock-Free）"></a>无锁（Lock-Free）</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>无锁是指在多线程环境中不使用传统的锁机制来控制对共享资源的访问，而是依赖原子操作保证线程安全。无锁状态不是指没有使用任何同步机制，而是指没有使用阻塞锁。在无锁编程中，通常使用原子操作（如CAS - Compare and Swap）来实现线程安全。这些操作保证在同一时间只有一个线程能够修改共享资源，从而避免了锁的使用。</p><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">AtomicInteger</span> <span class="variable">atomicInt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">    atomicInt.incrementAndGet();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>AtomicInteger</code> 提供了一种无锁的方式来确保多线程环境下的线程安全。</p><h2 id="偏向锁（Biased-Locking）"><a href="#偏向锁（Biased-Locking）" class="headerlink" title="偏向锁（Biased Locking）"></a>偏向锁（Biased Locking）</h2><h3 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h3><p>偏向锁是为单一线程访问优化的锁机制。它在锁对象上存储线程ID，使得同一线程的后续锁请求无需再进行完整的同步。</p><p>注：<span class="exturl" data-url="aHR0cHM6Ly9vcGVuamRrLm9yZy9qZXBzLzM3NA==">JDK15废弃了偏向锁<i class="fa fa-external-link-alt"></i></span></p><h3 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">biasedLockMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 偏向锁代码区</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在JVM中，默认启用偏向锁。首次进入同步块的线程会激活偏向锁。</p><h2 id="轻量级锁（Lightweight-Lock）"><a href="#轻量级锁（Lightweight-Lock）" class="headerlink" title="轻量级锁（Lightweight Lock）"></a>轻量级锁（Lightweight Lock）</h2><h3 id="定义-2"><a href="#定义-2" class="headerlink" title="定义"></a>定义</h3><p>轻量级锁是在偏向锁遇到竞争时的一种状态，介于偏向锁和重量级锁之间。轻量级锁在遇到竞争时，会使用一种称为”自旋”的技术来避免线程立即进入阻塞状态。自旋锁的基本思想是：当线程想要获取锁而锁已被其他线程占用时，线程不会立即挂起，而是在一段时间内循环检查锁是否已被释放，期望在很短的时间内获取到锁，从而减少线程挂起的开销。自旋锁在轻量级锁中是一个重要的优化，它能在适当的场景下提高程序性能，但也需要根据具体情况谨慎使用以避免资源浪费。</p><p>线程尝试使用CAS将对象头中的Mark Word替换为指向锁记录的指针。如果成功，当前线程获得锁，如果失败，则自旋获取锁，当自旋获取锁仍然失败时，表示存在其他线程竞争锁(两个或两个以上的线程竞争同一个锁)，则轻量级锁会升级成重量级锁。</p><h3 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LightweightLockExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            <span class="comment">// 在这里，当偏向锁遇到竞争时，JVM会自动升级为轻量级锁</span></span><br><span class="line">            <span class="comment">// 执行一些操作</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这个示例中，<code>synchronized</code>关键字用于在lock对象上同步。当这个方法被多个线程频繁调用，但并不满足重量级锁的条件（即线程阻塞不是很严重），JVM 会将偏向锁升级为轻量级锁。轻量级锁通过CAS操作和自旋来减少线程阻塞的开销，提高效率。</p><p>这个例子本身并不能直接展示轻量级锁的工作，因为这是JVM内部的实现细节。但它可以用来模拟可能触发轻量级锁升级的场景。轻量级锁的转换和工作机制通常是透明的，不需要（也不能）由开发者显式控制。</p><h2 id="重量级锁（Heavyweight-Lock）"><a href="#重量级锁（Heavyweight-Lock）" class="headerlink" title="重量级锁（Heavyweight Lock）"></a>重量级锁（Heavyweight Lock）</h2><h3 id="定义-3"><a href="#定义-3" class="headerlink" title="定义"></a>定义</h3><p>重量级锁是通过操作系统的互斥量实现的锁，当轻量级锁竞争激烈时会升级为重量级锁。</p><h3 id="示例-3"><a href="#示例-3" class="headerlink" title="示例"></a>示例</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">heavyWeightLockMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 在高竞争下使用重量级锁</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>多线程竞争同一个锁时，可能会导致轻量级锁升级为重量级锁。</p><h2 id="比较java-util-concurrent-Lock-与synchronized"><a href="#比较java-util-concurrent-Lock-与synchronized" class="headerlink" title="比较java.util.concurrent.Lock 与synchronized"></a>比较<code>java.util.concurrent.Lock</code> 与<code>synchronized</code></h2><p><code>java.util.concurrent</code> 包中的 <code>Lock</code> 类（如 <code>ReentrantLock</code>）与 <code>synchronized</code> 关键字所使用的内置锁机制（偏向锁、轻量级锁、重量级锁）是不同的。<code>Lock</code> 类提供了一种更为灵活、丰富的线程同步机制，如可中断的锁获取、公平性选择等。以下是一些关键点：</p><ol><li><p><strong>锁的类型</strong>：<code>Lock</code> 接口及其实现类（如 <code>ReentrantLock</code>）通常不会使用到JVM内部的偏向锁、轻量级锁、重量级锁。相反，它们通常直接依赖于操作系统的同步机制（类似于重量级锁），或者通过复杂的内部策略来提供锁功能。</p></li><li><p><strong>更多控制</strong>：与 <code>synchronized</code> 不同，<code>Lock</code> 类提供了更多的控制能力，比如尝试非阻塞地获取锁（<code>tryLock</code>），可中断的锁获取，以及公平性（公平锁或非公平锁）。</p></li><li><p><strong>公平性选项</strong>：例如，<code>ReentrantLock</code> 允许你选择是创建一个基于公平性原则的锁（先来先服务），还是一个非公平锁。<code>synchronized</code> 不提供这种选项。</p></li><li><p><strong>性能和特性</strong>：虽然 <code>synchronized</code> 在近期的Java版本中得到了显著优化，但在某些复杂的同步场景中，<code>Lock</code> 类可能提供更好的性能和灵活性。</p></li><li><p><strong>功能丰富</strong>：<code>Lock</code> 接口还提供了一些 <code>synchronized</code> 无法提供的功能，如条件变量（<code>Condition</code>），这为线程间的通信提供了更多的可能性。</p></li></ol><p>总而言之，<code>java.util.concurrent</code> 包中的 <code>Lock</code> 类并不直接使用JVM内部的锁状态（偏向锁、轻量级锁、重量级锁），而是提供了一个更高级、更灵活的线程同步机制。这些锁通常用于更复杂的并发场景，其中需要比 <code>synchronized</code> 提供的更细粒度的锁控制。</p><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>理解Java中这四种锁及其适用场景，以及它们与 <code>Lock</code> 类的区别，对于编写高效、线程安全的并发程序至关重要。开发者应根据实际应用场景选择合适的锁机制。</p></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>孙岚</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://blog.sunlan.me/2023/11/13/%E6%B5%85%E8%B0%88Java%E9%94%81%E6%9C%BA%E5%88%B6/" title="浅谈Java锁机制">https://blog.sunlan.me/2023/11/13/浅谈Java锁机制/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Java/" rel="tag"># Java</a> <a href="/tags/synchronized/" rel="tag"># synchronized</a> <a href="/tags/Lock/" rel="tag"># Lock</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2023/03/10/%E6%8E%A2%E7%A9%B6Java-Virtual-Thread/" rel="prev" title="探究Java Virtual Thread"><i class="fa fa-chevron-left"></i> 探究Java Virtual Thread</a></div><div class="post-nav-item"><a href="/2023/11/14/%E6%B5%85%E8%B0%88Java%E5%AD%97%E8%8A%82%E7%A0%81/" rel="next" title="浅谈Java字节码">浅谈Java字节码 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="gitalk-container"></div><script>window.addEventListener("tabs:register",()=>{let t=CONFIG.comments["activeClass"];var e;(t=CONFIG.comments.storage?localStorage.getItem("comments_active")||t:t)&&(e=document.querySelector(`a[href="#comment-${t}"]`))&&e.click()}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{t.target.matches(".tabs-comment .tab-content .tab-pane")&&(t=t.target.classList[1],localStorage.setItem("comments_active",t))})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java%E5%AF%B9%E8%B1%A1%E5%A4%B4%E4%B8%8EMark-Word"><span class="nav-number">2.</span> <span class="nav-text">Java对象头与Mark Word</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1%E5%A4%B4"><span class="nav-number">2.1.</span> <span class="nav-text">对象头</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mark-Word"><span class="nav-number">2.2.</span> <span class="nav-text">Mark Word</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%A0%E9%94%81%EF%BC%88Lock-Free%EF%BC%89"><span class="nav-number">3.</span> <span class="nav-text">无锁（Lock-Free）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89"><span class="nav-number">3.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B"><span class="nav-number">3.2.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%81%8F%E5%90%91%E9%94%81%EF%BC%88Biased-Locking%EF%BC%89"><span class="nav-number">4.</span> <span class="nav-text">偏向锁（Biased Locking）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-1"><span class="nav-number">4.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B-1"><span class="nav-number">4.2.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BD%BB%E9%87%8F%E7%BA%A7%E9%94%81%EF%BC%88Lightweight-Lock%EF%BC%89"><span class="nav-number">5.</span> <span class="nav-text">轻量级锁（Lightweight Lock）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-2"><span class="nav-number">5.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B-2"><span class="nav-number">5.2.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%87%8D%E9%87%8F%E7%BA%A7%E9%94%81%EF%BC%88Heavyweight-Lock%EF%BC%89"><span class="nav-number">6.</span> <span class="nav-text">重量级锁（Heavyweight Lock）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89-3"><span class="nav-number">6.1.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B-3"><span class="nav-number">6.2.</span> <span class="nav-text">示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AF%94%E8%BE%83java-util-concurrent-Lock-%E4%B8%8Esynchronized"><span class="nav-number">7.</span> <span class="nav-text">比较java.util.concurrent.Lock 与synchronized</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E8%AE%BA"><span class="nav-number">8.</span> <span class="nav-text">结论</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="孙岚" src="/images/avatar.jpg"><p class="site-author-name" itemprop="name">孙岚</p><div class="site-description" itemprop="description">格物致知，宁静致远</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">25</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">13</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">75</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RhbmllbGxhbnN1bg==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;daniellansun"><i class="fab fa-github fa-fw"></i>GitHub</span> </span><span class="links-of-author-item"><span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9kYW5pZWxfc3Vu" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;daniel_sun"><i class="fab fa-twitter fa-fw"></i>Twitter</span></span></div><div class="cc-license motion-element" itemprop="license"><span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2017 – <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">孙岚</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span title="站点总字数">44k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">2:42</span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/fancybox/jquery.min.js"></script><script src="/lib/fancybox/jquery.fancybox.min.js"></script><script src="/lib/lazyload/lozad.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(){var e,t,o,n,r=document.getElementsByTagName("link");if(0<r.length)for(i=0;i<r.length;i++)"canonical"==r[i].rel.toLowerCase()&&r[i].href&&(e=r[i].href);t=(e||window.location.protocol).split(":")[0],e=e||window.location.href,window,o=e,n=document.referrer,/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(o)||(t="https"===String(t).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif",n?(t+="?r="+encodeURIComponent(document.referrer),o&&(t+="&l="+o)):o&&(t+="?l="+o),(new Image).src=t)}()</script><script src="/js/local-search.js"></script><script>document.querySelectorAll(".pdfobject-container").forEach(e=>{var t=e.dataset.target,a="#"+Object.entries({navpanes:0,toolbar:0,statusbar:0,pagemode:"thumbs",view:"FitH"}).map(([e,t])=>e+"="+encodeURIComponent(t)).join("&"),r="/lib/pdf/web/viewer.html?file="+encodeURIComponent(t)+a;NexT.utils.supportsPDFs()?e.innerHTML=`<embed class="pdfobject" src="${t+a}" type="application/pdf" style="height: ${e.dataset.height};">`:e.innerHTML=`<iframe src="${r}" style="height: ${e.dataset.height};" frameborder="0"></iframe>`})</script><link rel="stylesheet" href="/lib/gitalk/gitalk.min.css"><script>NexT.utils.loadComments(document.querySelector("#gitalk-container"),()=>{NexT.utils.getScript("/lib/gitalk/gitalk.min.js",()=>{new Gitalk({clientID:"df78583b9a95e53afbe4",clientSecret:"293b9a1c1996f0b05efbf10cac455af14cd2471f",repo:"daniellansun.github.io",owner:"daniellansun",admin:["daniellansun"],id:"efa9a261c9e43eeb8456dd60ae4336dc",language:"zh-CN",distractionFreeMode:!0}).render("gitalk-container")},window.Gitalk)})</script></body></html>